name: Build Portable GNU Icecat with Trisquel

on:
  workflow_dispatch:

jobs:
  build-icecat:
    runs-on: ubuntu-latest
    container:
      image: kpengboy/trisquel
    steps:
      - name: Actualizar e instalar dependencias de compilaci√≥n
        run: |
          apt-get update
          apt-get install -y python3 python3-pip clang llvm pkg-config libasound2-dev libpulse-dev cbindgen nodejs libxkbcommon-dev libpango1.0-dev libx11-xcb-dev libxrandr-dev libxcomposite-dev libxcursor-dev libxdamage-dev libxfixes-dev libxi-dev libxtst-dev nasm libgtk-3-dev libdbus-glib-1-dev checkinstall git wget

      - name: Clonar el repositorio de GNUzilla
        run: git clone https://git.savannah.gnu.org/git/gnuzilla.git

      - name: Construir Icecat
        run: |
          cd gnuzilla
          ./makeicecat

      - name: Empaquetar binario portable
        run: |
          cd gnuzilla/output
          tar czf icecat-portable.tar.gz *

      - name: Subir artefacto portable
        uses: actions/upload-artifact@v4
        with:
          name: icecat-portable
          path: gnuzilla/output/icecat-portable.tar.gz
