name: Build Portable GNU Icecat with Parabola

on:
  workflow_dispatch:

jobs:
  build-icecat:
    runs-on: ubuntu-latest
    container:
      image: parabola/archlinux
    steps:
      - name: Actualizar e instalar dependencias de compilaci√≥n
        run: |
          pacman -Syu --noconfirm
          pacman -S --noconfirm base-devel git wget python python-pip clang llvm pkgconf \
            alsa-lib libpulse cbindgen nodejs xorg-xkbcommon pango \
            libx11 libxrandr libxcomposite libxcursor libxdamage libxfixes \
            libxi libxtst nasm gtk3 dbus-glib checkinstall

      - name: Clonar el repositorio de GNUzilla
        run: git clone https://git.savannah.gnu.org/git/gnuzilla.git

      - name: Construir Icecat
        run: |
          cd gnuzilla
          ./makeicecat

      - name: Empaquetar binario portable
        run: |
          cd gnuzilla/output
          tar czf icecat-portable.tar.gz *

      - name: Subir artefacto portable
        uses: actions/upload-artifact@v4
        with:
          name: icecat-portable
          path: gnuzilla/output/icecat-portable.tar.gz
